# MemoryLink CMS é–‹ç™ºãƒ­ã‚°

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: MemoryLink CMS
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v3.1
- **é–‹å§‹æ—¥**: 2024å¹´12æœˆ
- **ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒ**: ver1.1
- **æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: `32d72bb` (2024-12-19)

## ğŸ¯ å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

### âœ… å®Œäº†æ¸ˆã¿
1. **FirebaseåŸºç›¤æ§‹ç¯‰**
   - Firebase Hostingè¨­å®š (`firebase.json`)
   - Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ« (`firestore.rules`)
   - Next.jsé™çš„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š (`next.config.js`)

2. **èªè¨¼ã‚·ã‚¹ãƒ†ãƒ **
   - Firebase Auth Email/Passwordèªè¨¼
   - Firebase Auth Email Linkå®Ÿè£…
   - èªè¨¼ãƒ•ã‚©ãƒ¼ãƒ  (`src/components/auth-form.tsx`)

3. **ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ** (`src/lib/types.ts`)
   - `ClaimRequest`: ã‚¯ãƒ¬ãƒ¼ãƒ è¦æ±‚ç®¡ç†
   - `Memory`: ãƒ¡ãƒ¢ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œï¼‰
   - `User`: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
   - `Asset`: ã‚¢ã‚»ãƒƒãƒˆç®¡ç†
   - `Tenant`: ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†
   - `LandingPage`: LPç®¡ç†
   - `AuditLog`: ç›£æŸ»ãƒ­ã‚°

4. **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**
   - `POST /api/gate/lp-form`: LPãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†
   - `POST /api/gate/storefront`: ã‚¹ãƒˆã‚¢ãƒ•ãƒ­ãƒ³ãƒˆå‡¦ç†
   - `POST /api/claim/verify`: ã‚¯ãƒ¬ãƒ¼ãƒ æ¤œè¨¼
   - `POST /api/claim/change-email`: ãƒ¡ãƒ¼ãƒ«å¤‰æ›´
   - `POST /api/admin/claim-requests`: ç®¡ç†è€…å‘ã‘ã‚¯ãƒ¬ãƒ¼ãƒ ä¸€è¦§
   - `POST /api/admin/claim-requests/resend`: å†é€æ©Ÿèƒ½

5. **Firebase Admin SDKçµ±åˆ**
   - ä¸­å¤®é›†æ¨©çš„åˆæœŸåŒ– (`src/lib/firebase/admin.ts`)
   - ãƒ¡ãƒ¼ãƒ«ãƒªãƒ³ã‚¯é€ä¿¡æ©Ÿèƒ½ (`src/lib/email-link-utils.ts`)
   - è¨ºæ–­ç”¨APIç¾¤ (`src/app/api/test/`)

6. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**
   - ç®¡ç†UI (`src/app/(app)/_admin/`)
   - ã‚¯ãƒ¬ãƒ¼ãƒ å‡¦ç†UI (`src/app/claim/`)
   - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
   - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

7. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**
   - Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
   - ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
   - reCAPTCHAçµ±åˆæº–å‚™
   - ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œæº–å‚™

## ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Framework**: Next.js 14.2.4
- **UI**: React, TypeScript
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS
- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: Radix UI, Shadcn/ui
- **çŠ¶æ…‹ç®¡ç†**: React Hooks

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Runtime**: Next.js API Routes (Serverless)
- **Database**: Firebase Firestore
- **Authentication**: Firebase Auth
- **File Storage**: Firebase Storage (æº–å‚™æ¸ˆã¿)

### ã‚¤ãƒ³ãƒ•ãƒ©
- **Hosting**: Firebase Hosting
- **Functions**: Firebase Functions (æº–å‚™æ¸ˆã¿)
- **Monitoring**: Firebase Analytics
- **Security**: Firestore Security Rules

## ğŸš§ ç¾åœ¨ã®èª²é¡Œ

### ğŸ”´ é‡è¦ãªèª²é¡Œ
1. **Firebase Admin SDKèªè¨¼ã‚¨ãƒ©ãƒ¼**
   - ã‚¨ãƒ©ãƒ¼: `invalid_grant: Invalid grant: account not found`
   - çŠ¶æ³: è¨ºæ–­APIã¯æˆåŠŸã™ã‚‹ãŒã€ãƒ¡ãƒ¼ãƒ«ãƒªãƒ³ã‚¯é€ä¿¡ã§å¤±æ•—
   - å¯¾ç­–: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼å†ç”ŸæˆãŒå¿…è¦

### ğŸŸ¡ é€²è¡Œä¸­ã®ã‚¿ã‚¹ã‚¯
1. **ã‚¯ãƒ¬ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼å®Œæˆ**
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: `isSignInWithEmailLink` æ¤œå‡ºã¨ã‚µã‚¤ãƒ³ã‚¤ãƒ³å‡¦ç†
   - ãƒ¡ãƒ¼ãƒ«çªåˆ: ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚¯ãƒ¬ãƒ¼ãƒ è¦æ±‚ã®ç…§åˆ

2. **Stripe Webhookå®Ÿè£…**
   - ç½²åæ¤œè¨¼
   - æ±ºæ¸ˆæˆåŠŸæ™‚ã®ã‚¯ãƒ¬ãƒ¼ãƒ è¦æ±‚ä½œæˆ

## ğŸ“ é‡è¦ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
MemoryLinkCMS/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ (app)/_admin/          # ç®¡ç†UI
â”‚   â”‚   â”œâ”€â”€ api/                   # API routes
â”‚   â”‚   â”‚   â”œâ”€â”€ gate/             # ã‚²ãƒ¼ãƒˆå‡¦ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ claim/            # ã‚¯ãƒ¬ãƒ¼ãƒ å‡¦ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/            # ç®¡ç†è€…API
â”‚   â”‚   â”‚   â””â”€â”€ test/             # ãƒ‡ãƒãƒƒã‚°API
â”‚   â”‚   â”œâ”€â”€ claim/                # ã‚¯ãƒ¬ãƒ¼ãƒ å—ã‘å–ã‚ŠUI
â”‚   â”‚   â”œâ”€â”€ dashboard/            # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ login/                # ãƒ­ã‚°ã‚¤ãƒ³
â”‚   â”‚   â””â”€â”€ signup/               # ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
â”‚   â”œâ”€â”€ components/               # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ firebase/             # Firebaseè¨­å®š
â”‚   â”‚   â”‚   â”œâ”€â”€ admin.ts         # Admin SDK
â”‚   â”‚   â”‚   â””â”€â”€ client.ts        # Client SDK
â”‚   â”‚   â”œâ”€â”€ email-link-utils.ts  # ãƒ¡ãƒ¼ãƒ«ãƒªãƒ³ã‚¯æ©Ÿèƒ½
â”‚   â”‚   â””â”€â”€ types.ts             # å‹å®šç¾©
â”‚   â””â”€â”€ hooks/                   # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”œâ”€â”€ firestore.rules              # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
â”œâ”€â”€ firebase.json                # Firebaseè¨­å®š
â”œâ”€â”€ specification-v3.1.md       # ä»•æ§˜æ›¸
â””â”€â”€ TODOv3.1.md                 # å®Ÿè£…ã‚¿ã‚¹ã‚¯
```

## ğŸ”„ ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³

### æˆåŠŸã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤
- **Firebase Hosting**: é™çš„ã‚µã‚¤ãƒˆé…ä¿¡
- **Firestore Rules**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«æ›´æ–°

### è¨­å®šæ¸ˆã¿ç’°å¢ƒå¤‰æ•°
```bash
FIREBASE_PROJECT_ID="memorylink-cms"
FIREBASE_CLIENT_EMAIL="firebase-adminsdk-xxxxx@memorylink-cms.iam.gserviceaccount.com"
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
```

## ğŸ“Š å®Ÿè£…çµ±è¨ˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´**: 39ãƒ•ã‚¡ã‚¤ãƒ«
- **è¿½åŠ è¡Œæ•°**: 5,591è¡Œ
- **å‰Šé™¤è¡Œæ•°**: 308è¡Œ
- **æ–°è¦API**: 10ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **æ–°è¦ãƒšãƒ¼ã‚¸**: 5ãƒšãƒ¼ã‚¸

## ğŸ¯ æ¬¡ã®å®Ÿè£…å„ªå…ˆåº¦

### å„ªå…ˆA: Firebaseèªè¨¼å•é¡Œè§£æ±º
- [ ] ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼å†ç”Ÿæˆ
- [ ] ãƒ¡ãƒ¼ãƒ«ãƒªãƒ³ã‚¯é€ä¿¡ãƒ†ã‚¹ãƒˆ
- [ ] æ–°ã—ã„PCç’°å¢ƒã§ã®å‹•ä½œç¢ºèª

### å„ªå…ˆB: ã‚¯ãƒ¬ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼å®Œæˆ
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ãƒ¡ãƒ¼ãƒ«ãƒªãƒ³ã‚¯å‡¦ç†
- [ ] ãƒ¡ãƒ¼ãƒ«çªåˆãƒ­ã‚¸ãƒƒã‚¯
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### å„ªå…ˆC: Stripeçµ±åˆ
- [ ] Webhookç½²åæ¤œè¨¼
- [ ] æ±ºæ¸ˆæˆåŠŸæ™‚ã®å‡¦ç†
- [ ] ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰

### å„ªå…ˆD: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
- [ ] reCAPTCHAå®Ÿè£…
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™å®Ÿè£…
- [ ] ç›£æŸ»ãƒ­ã‚°å¼·åŒ–

## ğŸ“ é–‹ç™ºãƒ¡ãƒ¢

### è§£æ±ºæ¸ˆã¿ã®å•é¡Œ
1. **Firebase Deployç„¡é™ãƒ«ãƒ¼ãƒ—**: `predeploy`è¨­å®šã‚’å‰Šé™¤ã—ã¦è§£æ±º
2. **Next.jsé–‹ç™ºã‚µãƒ¼ãƒãƒ¼404**: æ¡ä»¶ä»˜ãé™çš„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®šã§è§£æ±º
3. **ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: FirebaseåˆæœŸåŒ–ã®éåŒæœŸå‡¦ç†æ”¹å–„ã§è§£æ±º

### å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ
- Firebase Admin SDKã®åˆæœŸåŒ–ã¯ä¸€åº¦ã ã‘è¡Œã†
- Next.jsé™çš„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã¨é–‹ç™ºç’°å¢ƒã®ä½¿ã„åˆ†ã‘
- Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®ãƒ†ãƒŠãƒ³ãƒˆåˆ¥åˆ¶å¾¡

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯
- **Firebase Console**: https://console.firebase.google.com/project/memorylink-cms
- **GitHub Repository**: https://github.com/Koheui/MemoryLinkCMS.git
- **Branch**: ver1.1

---
**æœ€çµ‚æ›´æ–°**: 2024-12-19
**æ›´æ–°è€…**: Development Team
