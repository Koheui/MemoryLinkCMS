emolink TODO.v.2.0 ãƒ¡ãƒ¼ãƒ«èªè¨¼é€£æº LPâ†’CMSæŒ‡ç¤º
TTO
# emolink CMSå´å®Ÿè£…æŒ‡ç¤ºæ›¸ v2.0


## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦


**emolink** ã®CMSå´ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚LPå´ã¯æ—¢ã«å®Œæˆæ¸ˆã¿ï¼ˆhttps://emolink.cloudï¼‰ã§ã€Firebase Authã«ã‚ˆã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹èªè¨¼ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒCMSã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ä»•çµ„ã¿ãŒæ•´ã£ã¦ã„ã¾ã™ã€‚


## ğŸ“Š ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³


### âœ… å®Œæˆæ¸ˆã¿ï¼ˆLPå´ï¼‰
- **ç”³ã—è¾¼ã¿ãƒ•ã‚©ãƒ¼ãƒ **: ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½
- **ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½**: Firebase Auth ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹èªè¨¼
- **ãƒ‡ãƒ¼ã‚¿ä¿å­˜**: Firestoreã¸ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ä¿å­˜
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: reCAPTCHA v3ã€CORSã€ç›£æŸ»ãƒ­ã‚°
- **ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°**: "emolink" ã¨ã—ã¦çµ±ä¸€


### âŒ æœªå®Ÿè£…ï¼ˆCMSå´ï¼‰
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¤ºãƒ»ç®¡ç†
- **æƒ³ã„å‡ºãƒšãƒ¼ã‚¸ä½œæˆ**: ã‚¿ã‚¤ãƒˆãƒ«ã€ç”»åƒã€å‹•ç”»ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **ç”»åƒãƒ»å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: Firebase Storage
- **NFCã‚¿ã‚°ç®¡ç†**: ã‚¿ã‚°ç”Ÿæˆãƒ»å‰²ã‚Šå½“ã¦ãƒ»QRã‚³ãƒ¼ãƒ‰
- **åˆ¶ä½œç®¡ç†**: åˆ¶ä½œæŒ‡ç¤ºæ›¸ã€é€²æ—ã€é…é€
- **ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†**: ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã®ç®¡ç†ãƒ»è¨­å®šï¼ˆé‡è¦ï¼‰


## ğŸš¨ ç·Šæ€¥ï¼šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ï¼ˆæœ€å„ªå…ˆå®Ÿè£…ï¼‰


### **âš ï¸ çµ¶å¯¾ã«å®Ÿè£…ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**


#### **1. Originãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒŠãƒ³ãƒˆæ¤œè¨¼ï¼ˆå¿…é ˆï¼‰**
```javascript
// âŒ å±é™ºãªå®Ÿè£…ï¼ˆçµ¶å¯¾ã«é¿ã‘ã‚‹ï¼‰
const { tenant, lpId } = req.body;  // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å€¤ã‚’ä¿¡é ¼


// âœ… å®‰å…¨ãªå®Ÿè£…ï¼ˆå¿…é ˆï¼‰
const origin = req.headers.origin || req.headers.referer || '';
const tenantInfo = getTenantFromOrigin(origin);
const actualTenant = tenantInfo.tenant;
const actualLpId = tenantInfo.lpId;
```


#### **2. ãƒ†ãƒŠãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢ï¼ˆå¿…é ˆï¼‰**
```javascript
// âŒ å±é™ºãªå®Ÿè£…
const query = db.collection("claimRequests").get();  // å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ãˆã‚‹


// âœ… å®‰å…¨ãªå®Ÿè£…
const query = db.collection("claimRequests")
 .where("tenant", "==", actualTenant)  // ãƒ†ãƒŠãƒ³ãƒˆã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
 .get();
```


#### **3. ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Ÿè£…ï¼ˆå¿…é ˆï¼‰**
```javascript
// Firestore Rules
match /claimRequests/{requestId} {
 allow read, write: if request.auth != null
   && request.auth.token.tenant == resource.data.tenant;
}


// Functionså´ã®æ¤œè¨¼
function validateUserTenant(userTenant: string, dataTenant: string): boolean {
 return userTenant === dataTenant;
}
```


### **ğŸ”§ å®Ÿè£…ã™ã¹ãé–¢æ•°**


#### **Originãƒ™ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆå–å¾—é–¢æ•°**
```typescript
// functions/src/utils/config.ts
export const ORIGIN_TENANT_MAP: { [origin: string]: { tenant: string; lpId: string } } = {
 'https://emolink.cloud': { tenant: 'petmem', lpId: 'direct' },
 'https://partner-a-lp.web.app': { tenant: 'client-a', lpId: 'main' },
 'https://partner-b-lp.web.app': { tenant: 'client-b', lpId: 'main' },
};


export function getTenantFromOrigin(origin: string): { tenant: string; lpId: string } {
 const tenantInfo = ORIGIN_TENANT_MAP[origin];
 if (!tenantInfo) {
   throw new Error(`Unknown origin: ${origin}`);
 }
 return tenantInfo;
}
```


### **ğŸš¨ æ”»æ’ƒã‚·ãƒŠãƒªã‚ªã¨å¯¾ç­–**
```javascript
// æ”»æ’ƒã‚·ãƒŠãƒªã‚ª
// 1. æ”»æ’ƒè€…ãŒclient-a.comã®LPã«ã‚¢ã‚¯ã‚»ã‚¹
// 2. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§tenant=client-b, lpId=mainã‚’é€ä¿¡
// 3. ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å€¤ã‚’ä¿¡é ¼
// 4. client-bã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ â†’ ãƒ‡ãƒ¼ã‚¿æ¼æ´©ï¼


// å¯¾ç­–
// 1. Originãƒ™ãƒ¼ã‚¹æ¤œè¨¼ã§æ­£ã—ã„ãƒ†ãƒŠãƒ³ãƒˆã‚’æ±ºå®š
// 2. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å€¤ã‚’çµ¶å¯¾ã«ä¿¡é ¼ã—ãªã„
// 3. ãƒ†ãƒŠãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã‚’å®Œå…¨ã«åˆ†é›¢
```


### **ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**


#### **å¿…é ˆå®Ÿè£…é …ç›®**
- [ ] Originãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒŠãƒ³ãƒˆæ¤œè¨¼é–¢æ•°
- [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå€¤ã®ç„¡è¦–ï¼ˆtenant/lpIdï¼‰
- [ ] ãƒ†ãƒŠãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- [ ] Firestore Rulesã§ã®ãƒ†ãƒŠãƒ³ãƒˆåˆ¶å¾¡
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã§ã®ãƒ†ãƒŠãƒ³ãƒˆæ¤œè¨¼
- [ ] å…¨ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã®ãƒ†ãƒŠãƒ³ãƒˆæ¤œè¨¼


#### **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆé …ç›®**
- [ ] ç•°ãªã‚‹ãƒ†ãƒŠãƒ³ãƒˆé–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢
- [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®tenant/lpIdå½è£…é˜²æ­¢
- [ ] æœªè¨±å¯ã®Originã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦
- [ ] ãƒ†ãƒŠãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿æ¼æ´©é˜²æ­¢


### **âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …**
1. **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å€¤ã‚’çµ¶å¯¾ã«ä¿¡é ¼ã—ãªã„**
2. **Originãƒ™ãƒ¼ã‚¹æ¤œè¨¼ã‚’å¿…ãšå®Ÿè£…ã™ã‚‹**
3. **ãƒ†ãƒŠãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢ã‚’å¾¹åº•ã™ã‚‹**
4. **å…¨ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ãƒ†ãƒŠãƒ³ãƒˆæ¤œè¨¼ã‚’è¡Œã†**
5. **Firestore Rulesã§ã®å¤šå±¤é˜²å¾¡ã‚’å®Ÿè£…ã™ã‚‹**


**ã“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…ã¯ã€ä»–ã®å…¨ã¦ã®æ©Ÿèƒ½ã‚ˆã‚Šå„ªå…ˆåº¦ãŒé«˜ãã€çµ¶å¯¾ã«å®Ÿè£…ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚**


## ğŸ—ï¸ æŠ€è¡“ä»•æ§˜


### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React/Vue.jsï¼ˆæ¨å¥¨ï¼‰
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Firebase Functionsï¼ˆæ—¢å­˜ï¼‰
- **èªè¨¼**: Firebase Authï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹èªè¨¼ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Firestore
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Firebase Storage
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: Firebase Hosting


### ç’°å¢ƒè¨­å®š
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: memorylink-cms
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: asia-northeast1
- **ãƒ‰ãƒ¡ã‚¤ãƒ³**: https://emolink.net
- **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: https://asia-northeast1-memorylink-cms.cloudfunctions.net/api


## ğŸ“‹ å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º


### Phase 1: åŸºæœ¬æ©Ÿèƒ½ï¼ˆæœ€å„ªå…ˆï¼‰


#### 1.1 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢
```javascript
// è¦ä»¶
- Firebase Authã§ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- Firestoreã®usersã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¡¨ç¤º
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ï¼ˆemail, status, createdAtï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°è¡¨ç¤º
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ï¼ˆpending â†’ verified â†’ processing â†’ shippedï¼‰


// å®Ÿè£…é †åº
1. èªè¨¼ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—ãƒ»è¡¨ç¤º
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ç”»é¢
4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°æ©Ÿèƒ½


// å‚è€ƒãƒ‡ãƒ¼ã‚¿
- API: https://asia-northeast1-memorylink-cms.cloudfunctions.net/api
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾‹: {email: "test@example.com", status: "verified", tenant: "petmem"}
```


#### 1.2 æƒ³ã„å‡ºãƒšãƒ¼ã‚¸ä½œæˆ
```javascript
// è¦ä»¶
- èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®æƒ³ã„å‡ºãƒšãƒ¼ã‚¸ã‚’ä½œæˆå¯èƒ½
- ã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜æ–‡ã®å…¥åŠ›
- ç”»åƒãƒ»å‹•ç”»ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆFirebase Storageï¼‰
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¿½åŠ ãƒ»ç·¨é›†
- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
- å…¬é–‹ãƒ»éå…¬é–‹ã®åˆ‡ã‚Šæ›¿ãˆ


// ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
memoryPages: {
 userId: string,
 title: string,
 description: string,
 photos: string[],
 videos: string[],
 messages: string[],
 status: "draft" | "published" | "shipped",
 createdAt: timestamp,
 updatedAt: timestamp
}


// å®Ÿè£…é †åº
1. ãƒšãƒ¼ã‚¸ä½œæˆãƒ•ã‚©ãƒ¼ãƒ 
2. ç”»åƒãƒ»å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
3. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
4. ä¿å­˜ãƒ»æ›´æ–°æ©Ÿèƒ½
```


### Phase 2: é«˜åº¦æ©Ÿèƒ½


#### 2.1 NFCã‚¿ã‚°ç®¡ç†
```javascript
// è¦ä»¶
- æƒ³ã„å‡ºãƒšãƒ¼ã‚¸ã¨NFCã‚¿ã‚°ã®ç´ä»˜ã‘
- NFCã‚¿ã‚°IDã®ç”Ÿæˆãƒ»ç®¡ç†
- QRã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆãƒ»è¡¨ç¤º
- é…é€ç®¡ç†ï¼ˆã‚¿ã‚°ã®å‰²ã‚Šå½“ã¦ãƒ»ç™ºé€ï¼‰


// ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
nfcTags: {
 nfcId: string,
 memoryPageId: string,
 userId: string,
 qrCode: string,
 status: "available" | "assigned" | "shipped",
 assignedAt: timestamp,
 shippedAt: timestamp
}


// å®Ÿè£…é †åº
1. NFCã‚¿ã‚°ç”Ÿæˆæ©Ÿèƒ½
2. æƒ³ã„å‡ºãƒšãƒ¼ã‚¸ã¨ã®ç´ä»˜ã‘
3. QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ»è¡¨ç¤º
4. é…é€ç®¡ç†ç”»é¢
```


#### 2.2 åˆ¶ä½œç®¡ç†
```javascript
// è¦ä»¶
- æ³¨æ–‡ç®¡ç†ï¼ˆordersï¼‰
- åˆ¶ä½œæŒ‡ç¤ºæ›¸ä½œæˆ
- é€²æ—ç®¡ç†
- é…é€ç®¡ç†


// ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
orders: {
 orderId: string,
 userId: string,
 memoryPageId: string,
 productType: "acrylic",
 status: "pending" | "processing" | "shipped" | "delivered",
 nfcTagId: string,
 shippingAddress: object,
 createdAt: timestamp,
 updatedAt: timestamp
}
```


#### 2.3 ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†ï¼ˆé‡è¦ï¼‰
```javascript
// è¦ä»¶
- ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã®è¡¨ç¤ºãƒ»ç®¡ç†
- ãƒ†ãƒŠãƒ³ãƒˆè¨­å®šã®ç·¨é›†
- æ–°è¦ãƒ†ãƒŠãƒ³ãƒˆã®ä½œæˆ
- ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†
- ãƒ†ãƒŠãƒ³ãƒˆåˆ¥LPè¨­å®šã®ç®¡ç†


// ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
tenants: {
 tenantId: string,
 name: string,
 description?: string,
 allowedLpIds: string[],
 enabledProductTypes: string[],
 settings: {
   maxClaimRequestsPerHour: number,
   emailTemplate: string,
   branding: {
     logo?: string,
     colors: string[],
     theme: string
   },
   fulfillmentMode: "tenantDirect" | "vendorDirect"
 },
 status: "active" | "inactive" | "suspended",
 createdAt: timestamp,
 updatedAt: timestamp
}


// å®Ÿè£…é †åº
1. ãƒ†ãƒŠãƒ³ãƒˆä¸€è¦§è¡¨ç¤º
2. ãƒ†ãƒŠãƒ³ãƒˆè©³ç´°è¡¨ç¤º
3. ãƒ†ãƒŠãƒ³ãƒˆè¨­å®šç·¨é›†
4. æ–°è¦ãƒ†ãƒŠãƒ³ãƒˆä½œæˆ
5. ãƒ†ãƒŠãƒ³ãƒˆåˆ¥ãƒ‡ãƒ¼ã‚¿ç®¡ç†
```


### Phase 3: è‡ªå‹•åŒ–ãƒ»åˆ†æ


#### 3.1 é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
```javascript
// è¦ä»¶
- æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥
- åˆ¶ä½œå®Œäº†é€šçŸ¥
- é…é€é€šçŸ¥
- æ”¯æ‰•ã„é€šçŸ¥


// å®Ÿè£…
- ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ï¼ˆNodemailerï¼‰
- ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ï¼ˆFirebase Cloud Messagingï¼‰
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°é€šçŸ¥
```


#### 3.2 åˆ†ææ©Ÿèƒ½
```javascript
// è¦ä»¶
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†æ
- å£²ä¸Šåˆ†æ
- åˆ¶ä½œåŠ¹ç‡åˆ†æ


// å®Ÿè£…
- Firestore Analytics
- Google Analytics é€£æº
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
```


## ğŸ”§ æŠ€è¡“çš„è©³ç´°


### ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã®å…±æœ‰çŠ¶æ³ï¼ˆé‡è¦ï¼‰
```javascript
// ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³
LPå´: {
 tenant: "petmem",           // ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
 lpId: "direct"              // ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
}


Functionså´: {
 TENANT_CONFIG: {            // ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
   petmem: {
     allowedLpIds: ["direct", "partner1", "partner2"],
     enabledProductTypes: ["acrylic", "digital", "premium"]
   }
 }
}


CMSå´: {
 ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†: "æœªå®Ÿè£…",      // å®Ÿè£…ãŒå¿…è¦
 å‹•çš„è¨­å®š: "æœªå®Ÿè£…"          // å®Ÿè£…ãŒå¿…è¦
}


// æ”¹å–„å¾Œã®å®Ÿè£…
Firestore: {
 tenants/{tenantId}: {       // å‹•çš„ãƒ‡ãƒ¼ã‚¿
   id: "petmem",
   name: "PetMemory Inc.",
   allowedLpIds: ["direct", "partner1"],
   settings: { ... }
 }
}


CMSå´: {
 ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†: "å®Ÿè£…æ¸ˆã¿",    // ç®¡ç†ç”»é¢
 å‹•çš„è¨­å®š: "å®Ÿè£…æ¸ˆã¿"        // è¨­å®šå¤‰æ›´å¯èƒ½
}
```


### Firebaseè¨­å®š
```javascript
// æ—¢å­˜è¨­å®š
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: memorylink-cms
- ãƒªãƒ¼ã‚¸ãƒ§ãƒ³: asia-northeast1
- èªè¨¼: ãƒ¡ãƒ¼ãƒ«ãƒªãƒ³ã‚¯èªè¨¼æœ‰åŠ¹
- CORS: è¨±å¯ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šæ¸ˆã¿
- Firestoreãƒ«ãƒ¼ãƒ«: è¨­å®šæ¸ˆã¿
- Storageãƒ«ãƒ¼ãƒ«: è¨­å®šæ¸ˆã¿
```


### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶
```javascript
// å¿…é ˆå®Ÿè£…
- CORSè¨­å®šï¼ˆè¨±å¯ã•ã‚ŒãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã¿ï¼‰
- reCAPTCHA v3æ¤œè¨¼
- Rate Limitingï¼ˆéåº¦ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™ï¼‰
- Audit Loggingï¼ˆå…¨ã¦ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨˜éŒ²ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆå…¨ãƒšãƒ¼ã‚¸ï¼‰
```


### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```javascript
// å®Œå…¨ãªãƒ•ãƒ­ãƒ¼
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ LPãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ› â†’ ãƒ¡ãƒ¼ãƒ«é€ä¿¡


2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†ï¼ˆFirebase Functionsï¼‰
  ãƒ¡ãƒ¼ãƒ«å—ä¿¡ â†’ reCAPTCHAæ¤œè¨¼ â†’ ãƒ‡ãƒ¼ã‚¿ä¿å­˜ â†’ èªè¨¼ãƒ¡ãƒ¼ãƒ«é€ä¿¡


3. ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
  èªè¨¼ãƒ¡ãƒ¼ãƒ«å—ä¿¡ â†’ ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯ â†’ èªè¨¼å®Œäº† â†’ CMSãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ


4. CMSå´å‡¦ç†
  CMSãƒ­ã‚°ã‚¤ãƒ³ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º â†’ æƒ³ã„å‡ºãƒšãƒ¼ã‚¸ä½œæˆ â†’ ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ å…¬é–‹


5. ç‰©ç†å•†å“ã®åˆ¶ä½œ
  CMSãƒ‡ãƒ¼ã‚¿ â†’ åˆ¶ä½œæŒ‡ç¤º â†’ ã‚¢ã‚¯ãƒªãƒ«ã‚¹ã‚¿ãƒ³ãƒ‰åˆ¶ä½œ â†’ NFCã‚¿ã‚°è¨­å®š â†’ é…é€
```


## ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ§‹é€ è©³ç´°


### æ—¢å­˜ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
```javascript
// users/{uid}
{
 email: string,
 displayName?: string,
 createdAt: timestamp,
 updatedAt: timestamp,
 status: "pending" | "verified" | "processing" | "shipped"
}


// claimRequests/{requestId}
{
 email: string,
 tenant: string,
 lpId: string,
 productType: string,
 status: "pending" | "sent" | "claimed" | "expired",
 sentAt?: timestamp,
 claimedAt?: timestamp
}
```


### æ–°è¦ä½œæˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
```javascript
// memories/{memoryId}
{
 ownerUid: string,
 tenant: string,
 lpId: string,
 title: string,
 description: string,
 type: "acrylic",
 status: "draft" | "published" | "shipped",
 publicPageId: string,
 design: {
   theme: string,
   fontScale: number
 },
 blocks: array,
 createdAt: timestamp,
 updatedAt: timestamp
}


// assets/{assetId}
{
 memoryId: string,
 ownerUid: string,
 type: "image" | "video" | "audio",
 storagePath: string,
 url: string,
 thumbnailUrl?: string,
 size: number,
 createdAt: timestamp
}


// publicPages/{pageId}
{
 tenant: string,
 memoryId: string,
 title: string,
 about?: string,
 design: object,
 media: object,
 ordering: array,
 publish: {
   status: "draft" | "published",
   version: number,
   publishedAt: timestamp
 },
 access: {
   mode: "public" | "private"
 },
 createdAt: timestamp
}


// orders/{orderId}
{
 tenant: string,
 lpId: string,
 orderRef: string,
 ownerUid?: string,
 memoryId?: string,
 publicPageId?: string,
 productType: "acrylic",
 fulfillmentMode: "tenantDirect" | "vendorDirect",
 status: "pending" | "processing" | "shipped" | "delivered",
 print: {
   qrPrinted: boolean
 },
 nfc: {
   written: boolean,
   pageUrl: string,
   device: string,
   operator: string,
   prevUrl?: string,
   writtenAt?: timestamp
 },
 shipping: {
   packed: boolean,
   shippedAt?: timestamp,
   trackingNo?: string,
   address?: object
 },
 createdAt: timestamp,
 updatedAt: timestamp
}
```


## ğŸ¯ å®Ÿè£…å„ªå…ˆé †ä½


### æœ€å„ªå…ˆï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ï¼‰
1. **Originãƒ™ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆæ¤œè¨¼** - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå€¤ç„¡è¦–ãƒ»Originãƒ™ãƒ¼ã‚¹æ¤œè¨¼
2. **ãƒ†ãƒŠãƒ³ãƒˆé–“ãƒ‡ãƒ¼ã‚¿åˆ†é›¢** - å…¨ã¦ã®ã‚¯ã‚¨ãƒªã§ãƒ†ãƒŠãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
3. **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡å®Ÿè£…** - Firestore Rulesãƒ»Functionså´æ¤œè¨¼


### é«˜å„ªå…ˆï¼ˆPhase 1ï¼‰
1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢** - èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¤ºãƒ»ç®¡ç†
2. **æƒ³ã„å‡ºãƒšãƒ¼ã‚¸ä½œæˆ** - åŸºæœ¬æƒ…å ±å…¥åŠ›ãƒ»ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
3. **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½** - ä½œæˆã—ãŸãƒšãƒ¼ã‚¸ã®ç¢ºèª


### ä¸­å„ªå…ˆï¼ˆPhase 2ï¼‰
1. **NFCã‚¿ã‚°ç®¡ç†** - ã‚¿ã‚°ç”Ÿæˆãƒ»å‰²ã‚Šå½“ã¦
2. **QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ** - è¡¨ç¤ºãƒ»å°åˆ·
3. **åˆ¶ä½œç®¡ç†** - æ³¨æ–‡ãƒ»é€²æ—ç®¡ç†
4. **ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†** - ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ãƒ»è¨­å®šç®¡ç†ï¼ˆé‡è¦ï¼‰


### ä½å„ªå…ˆï¼ˆPhase 3ï¼‰
1. **é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ** - è‡ªå‹•é€šçŸ¥
2. **åˆ†ææ©Ÿèƒ½** - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
3. **é«˜åº¦ãªUI** - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–


## ğŸ” å—ã‘å…¥ã‚Œæ¡ä»¶


### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶å®Œäº†æ¡ä»¶ï¼ˆæœ€å„ªå…ˆï¼‰
- [ ] Originãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒŠãƒ³ãƒˆæ¤œè¨¼ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸtenant/lpIdãŒç„¡è¦–ã•ã‚Œã‚‹
- [ ] å…¨ã¦ã®ã‚¯ã‚¨ãƒªã§ãƒ†ãƒŠãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã‚‹
- [ ] Firestore Rulesã§ãƒ†ãƒŠãƒ³ãƒˆåˆ¶å¾¡ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ç•°ãªã‚‹ãƒ†ãƒŠãƒ³ãƒˆé–“ã§ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãŒé˜²æ­¢ã•ã‚Œã‚‹
- [ ] æœªè¨±å¯ã®Originã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã‚‹


### Phase 1å®Œäº†æ¡ä»¶
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] èªè¨¼ãƒã‚§ãƒƒã‚¯ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] æƒ³ã„å‡ºãƒšãƒ¼ã‚¸ãŒä½œæˆã§ãã‚‹
- [ ] ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹


### Phase 2å®Œäº†æ¡ä»¶
- [ ] NFCã‚¿ã‚°ãŒç”Ÿæˆãƒ»å‰²ã‚Šå½“ã¦ã§ãã‚‹
- [ ] QRã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆãƒ»è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] åˆ¶ä½œç®¡ç†ãŒã§ãã‚‹
- [ ] é…é€ç®¡ç†ãŒã§ãã‚‹
- [ ] ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ãŒç®¡ç†ã§ãã‚‹
- [ ] æ–°è¦ãƒ†ãƒŠãƒ³ãƒˆãŒä½œæˆã§ãã‚‹


### Phase 3å®Œäº†æ¡ä»¶
- [ ] é€šçŸ¥ãŒè‡ªå‹•é€ä¿¡ã•ã‚Œã‚‹
- [ ] åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] å…¨ã¦ã®æ©Ÿèƒ½ãŒçµ±åˆã•ã‚Œã¦ã„ã‚‹


## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—


1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã‹ã‚‰é–‹å§‹**: Originãƒ™ãƒ¼ã‚¹ãƒ†ãƒŠãƒ³ãƒˆæ¤œè¨¼ã®å®Ÿè£…
2. **Phase 1ã®å®Ÿè£…**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢ã®å®Ÿè£…
3. **æ®µéšçš„å®Ÿè£…**: å„ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã«ãƒ†ã‚¹ãƒˆãƒ»ç¢ºèª
4. **çµ±åˆãƒ†ã‚¹ãƒˆ**: å…¨æ©Ÿèƒ½ã®é€£æºç¢ºèª
5. **æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤**: æ®µéšçš„ãªãƒªãƒªãƒ¼ã‚¹


## âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …


### ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã®æ•´åˆæ€§
- **ç¾åœ¨**: LPå´ã¨Functionså´ã§ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹
- **å•é¡Œ**: æ–°è¦ãƒ†ãƒŠãƒ³ãƒˆè¿½åŠ æ™‚ã«ã‚³ãƒ¼ãƒ‰å¤‰æ›´ãŒå¿…è¦
- **è§£æ±º**: CMSå´ã§ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€å‹•çš„ã«ç®¡ç†å¯èƒ½ã«ã™ã‚‹
- **å„ªå…ˆåº¦**: Phase 2ã§å¿…ãšå®Ÿè£…ï¼ˆãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ãŸã‚ï¼‰


### ãƒ‡ãƒ¼ã‚¿åˆ†é›¢ã®é‡è¦æ€§
- **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ**: å„ãƒ†ãƒŠãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«åˆ†é›¢
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ãƒ†ãƒŠãƒ³ãƒˆé–“ã§ã®ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã‚’é˜²ã
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: æ–°è¦ãƒ†ãƒŠãƒ³ãƒˆã®è¿½åŠ ã‚’å®¹æ˜“ã«ã™ã‚‹


---


**ã“ã®æŒ‡ç¤ºæ›¸ã«å¾“ã£ã¦å®Ÿè£…ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚å„ãƒ•ã‚§ãƒ¼ã‚ºãŒå®Œäº†ã—ãŸã‚‰ã€æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã«é€²ã‚€å‰ã«å¿…ãšãƒ†ã‚¹ãƒˆãƒ»ç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„ã€‚**




